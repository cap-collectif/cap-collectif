services:
  _defaults:
    autoconfigure: true
    autowire: true
    public: false

  Capco\AppBundle\Elasticsearch\:
    resource: '%kernel.project_dir%/src/Capco/AppBundle/Elasticsearch/*'
    exclude: '%kernel.project_dir%/src/Capco/AppBundle/Elasticsearch/{ElasticsearchHelper.php}'

  Capco\AppBundle\Elasticsearch\Client:
    autowire: true
    public: true
    arguments:
      - connections:
          - { host: '%elasticsearch_host%', port: '9200' }
      - ~
      - '@Capco\AppBundle\Elasticsearch\ElasticsearchLogger'
      - '%kernel.debug%'

  Capco\AppBundle\Elasticsearch\IndexBuilder:
    autowire: true
    public: true

  Capco\AppBundle\Elasticsearch\Indexer:
    autowire: true
    public: true

  Elastica\Index:
    autowire: true
    public: true
    factory: ['@Capco\AppBundle\Elasticsearch\IndexBuilder', getLiveSearchIndex]

  Capco\AppBundle\Elasticsearch\ElasticaToDoctrineTransformer:
    autowire: true
    public: true
    calls:
      - ['setPropertyAccessor', ['@property_accessor']]

  Capco\AppBundle\Elasticsearch\ElasticsearchDoctrineListener:
    autowire: true
    public: true
    tags:
      - { name: doctrine.event_subscriber, connection: default }
