# We allow only geolocation, microphone, audio, video
add_header Permissions-Policy
    "xr-spatial-tracking=(self), geolocation=(self), midi=(), sync-xhr=(), microphone=(self), camera=(self), magnetometer=(), gyroscope=(), fullscreen=(self), payment=()"
    always;

# https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy
# https://github.com/cap-collectif/platform/issues/12179
add_header Referrer-Policy "no-referrer-when-downgrade" always;

# Already sent by Cloudflare but only here for backward compatibility.
add_header X-Content-Type-Options "nosniff" always;

# https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection
add_header X-Xss-Protection "1; mode=block" always;

# This policy needs heavy work to be secured. For the moment we allow everything
add_header Content-Security-Policy
    "default-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' *; connect-src 'self' maps.googleapis.com *.cloudfront.net backend.getbeamer.com beaconapi.helpscout.net; img-src 'self' data: *; frame-ancestors 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' app.getbeamer.com; frame-src 'self' https://challenges.cloudflare.com https://www.google.com/recaptcha/ https://recaptcha.google.com/recaptcha/ app.getbeamer.com *"
    always;

add_header Access-Control-Allow-Origin "$http_origin" always;
