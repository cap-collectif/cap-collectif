services:
  application:
    hostname: capco.test
    environment:
      DOCKER_GID: 998
      BLACKFIRE_LOG_LEVEL: 1
      CI: ${CI}
      CIRCLE_JOB: ${CIRCLE_JOB}
      # Set the following variables on CircleCI
      # https://app.circleci.com/settings/project/github/cap-collectif/platform/environment-variables
      SYMFONY_DEPLOYER_API_URL: ${SYMFONY_DEPLOYER_API_URL}
      SYMFONY_GOOGLE_MAP_PUBLIC_KEY: ${SYMFONY_GOOGLE_MAP_PUBLIC_KEY}
      SYMFONY_GOOGLE_MAP_SERVER_KEY: ${SYMFONY_GOOGLE_MAP_SERVER_KEY}
      SYMFONY_MAPBOX_PUBLIC_KEY: ${SYMFONY_MAPBOX_PUBLIC_KEY}
      SYMFONY_MAPBOX_SECRET_KEY: ${SYMFONY_MAPBOX_SECRET_KEY}
      SYMFONY_RECAPTCHA_PRIVATE_KEY: ${SYMFONY_RECAPTCHA_PRIVATE_KEY}
      SYMFONY_PANTHER_URL: ${SYMFONY_PANTHER_URL}
      SYMFONY_PANTHER_TOKEN: ${SYMFONY_PANTHER_TOKEN}
      SYMFONY_MAILJET_PRIVATE_KEY: ${SYMFONY_MAILJET_PRIVATE_KEY}
      SYMFONY_MAILJET_PUBLIC_KEY: ${SYMFONY_MAILJET_PUBLIC_KEY}
      SYMFONY_MANDRILL_API_KEY: ${SYMFONY_MANDRILL_API_KEY}
      SYMFONY_INSTANCE_REMEMBER_SECRET: ${SYMFONY_INSTANCE_REMEMBER_SECRET}
      SYMFONY_SMS_PROVIDER: ${SYMFONY_SMS_PROVIDER}
      SYMFONY_TWILIO_SID: ${SYMFONY_TWILIO_SID}
      SYMFONY_TWILIO_TOKEN: ${SYMFONY_TWILIO_TOKEN}
      SYMFONY_TWILIO_DEFAULT_SUBACCOUNT_TOKEN: ${SYMFONY_TWILIO_DEFAULT_SUBACCOUNT_TOKEN}
      SYMFONY_TWILIO_DEFAULT_SUBACCOUNT_SID: ${SYMFONY_TWILIO_DEFAULT_SUBACCOUNT_SID}
      SYMFONY_TWILIO_DEFAULT_VERIFY_SERVICE_ID: ${SYMFONY_TWILIO_DEFAULT_VERIFY_SERVICE_ID}
      SYMFONY_ORANGE_API_CLIENT_ID: ${SYMFONY_ORANGE_API_CLIENT_ID}
      SYMFONY_ORANGE_API_CLIENT_SECRET: ${SYMFONY_ORANGE_API_CLIENT_SECRET}
      SYMFONY_ORANGE_REQUEST_ID_EXPIRATION_TIME: ${SYMFONY_ORANGE_REQUEST_ID_EXPIRATION_TIME}
      SYMFONY_LOGPUSH_ELASTICSEARCH_HOST: ${SYMFONY_LOGPUSH_ELASTICSEARCH_HOST}
      SYMFONY_LOGPUSH_ELASTICSEARCH_PORT: ${SYMFONY_LOGPUSH_ELASTICSEARCH_PORT}
      SYMFONY_LOGPUSH_ELASTICSEARCH_INDEX: ${SYMFONY_LOGPUSH_ELASTICSEARCH_INDEX}
      SYMFONY_LOGPUSH_ELASTICSEARCH_USERNAME: ${SYMFONY_LOGPUSH_ELASTICSEARCH_USERNAME}
      SYMFONY_LOGPUSH_ELASTICSEARCH_PASSWORD: ${SYMFONY_LOGPUSH_ELASTICSEARCH_PASSWORD}
      SYMFONY_DEFAULT_FACEBOOK_CLIENT_ID: ${SYMFONY_DEFAULT_FACEBOOK_CLIENT_ID}
      SYMFONY_DEFAULT_FACEBOOK_SECRET: ${SYMFONY_DEFAULT_FACEBOOK_SECRET}
      SYMFONY_DEFAULT_FRANCE_CONNECT_CLIENT_ID: ${SYMFONY_DEFAULT_FRANCE_CONNECT_CLIENT_ID}
      SYMFONY_DEFAULT_FRANCE_CONNECT_CLIENT_SECRET: ${SYMFONY_DEFAULT_FRANCE_CONNECT_CLIENT_SECRET}
      SYMFONY_DEFAULT_OAUTH_CLIENT_ID: ${SYMFONY_DEFAULT_OAUTH_CLIENT_ID}
      SYMFONY_DEFAULT_OAUTH_CLIENT_SECRET: ${SYMFONY_DEFAULT_OAUTH_CLIENT_SECRET}
      SYMFONY_DEFAULT_OAUTH_AUTHORIZATION_URL: ${SYMFONY_DEFAULT_OAUTH_AUTHORIZATION_URL}
      SYMFONY_DEFAULT_OAUTH_ACCESS_TOKEN_URL: ${SYMFONY_DEFAULT_OAUTH_ACCESS_TOKEN_URL}
      SYMFONY_DEFAULT_OAUTH_USER_INFO_URL: ${SYMFONY_DEFAULT_OAUTH_USER_INFO_URL}
      SYMFONY_DEFAULT_OAUTH_LOGOUT_URL: ${SYMFONY_DEFAULT_OAUTH_LOGOUT_URL}
      SYMFONY_DEFAULT_OAUTH_PROFILE_URL: ${SYMFONY_DEFAULT_OAUTH_PROFILE_URL}
      SYMFONY_CAS_CERTIFICATE_DIRECTORY: ${SYMFONY_CAS_CERTIFICATE_DIRECTORY}
      SYMFONY_REDIS_PREFIX: ${SYMFONY_REDIS_PREFIX}
      SYMFONY_LOGIN_SAML_ALLOWED: 'False'
      SYMFONY_SENDINBLUE_API_KEY: ${SYMFONY_SENDINBLUE_API_KEY}
      SYMFONY_SENDINBLUE_NL_LIST_ID: ${SYMFONY_SENDINBLUE_NL_LIST_ID}
      SYMFONY_SENDINBLUE_SECRET: ${SYMFONY_SENDINBLUE_SECRET}
      SYMFONY_OPENID_BACKCHANNEL_SECRET: ${SYMFONY_OPENID_BACKCHANNEL_SECRET}
      SYMFONY_OPENID_BACKCHANNEL_SECRET_DEV: ${SYMFONY_OPENID_BACKCHANNEL_SECRET_DEV}
      SYMFONY_OPENID_TEST_USERNAME: ${SYMFONY_OPENID_TEST_USERNAME}
      SYMFONY_OPENID_TEST_PASSWORD: ${SYMFONY_OPENID_TEST_PASSWORD}
      SYMFONY_MAGICLINKS_DURATION_IN_MINUTES: ${SYMFONY_MAGICLINKS_DURATION_IN_MINUTES}
      XDEBUG_MODE: ${XDEBUG_MODE}

    extra_hosts:
      - 'nextjs:127.0.0.1'
    volumes:
      - ../../:/var/www
      - /etc/localtime:/etc/localtime:ro
      - /tmp:/tmp

  database:
    image: circleci/mariadb:10.3
    volumes:
      - /tmp:/tmp

  redis:
    image: circleci/redis:3
    ports:
      - '6379:6379'
